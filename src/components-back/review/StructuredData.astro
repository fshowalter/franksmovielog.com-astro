---
import type { Review } from "@/api/reviews";

export interface Props {
  review: Pick<Review, "title" | "imdbId" | "directorNames" | "year" | "grade">;
}

const { review } = Astro.props;

const gradeMap: Record<string, number> = {
  A: 5,
  B: 4,
  C: 3,
  D: 2,
  F: 1,
};

let reviewGrade = review.grade ? review.grade.slice(0, 1) : "";

const reviewGradeValue = gradeMap[reviewGrade];

const structuredData = {
  "@context": "http://schema.org",
  "@type": "Review",
  itemReviewed: {
    "@type": "Movie",
    name: review.title,
    sameAs: `http://www.imdb.com/title/${review.imdbId}/`,
    dateCreated: review.year,
    director: {
      "@type": "Person",
      name: review.directorNames[0],
    },
  },
  reviewRating: {
    "@type": "Rating",
    ratingValue: reviewGradeValue,
  },
  author: {
    "@type": "Person",
    name: "Frank Showalter",
  },
};
---

<script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
