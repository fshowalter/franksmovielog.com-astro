---
import { toSentence } from "@/utils";
import Grade from "@/components/Grade.astro";
import { RenderedMarkdown } from "@/components/RenderedMarkdown.tsx";
import Still from "@/components/Still.astro";
import type { Review } from "@/api/reviews";

function formatDate(reviewDate: Date) {
  return reviewDate.toLocaleString("en-GB", {
    day: "2-digit",
    month: "short",
    year: "numeric",
    timeZone: "UTC",
  });
}

interface Props {
  review: Pick<
    Review,
    | "imdbId"
    | "sequence"
    | "title"
    | "year"
    | "date"
    | "slug"
    | "grade"
    | "principalCastNames"
    | "directorNames"
    | "excerpt"
  >;
  eagerLoadImage: boolean;
}

const { review, eagerLoadImage } = Astro.props;
---

<li class="flex even:bg-subtle">
  <article
    class="mx-auto flex flex-col items-center px-pageMargin py-10 desktop:grid desktop:w-full desktop:grid-cols-8"
  >
    <div
      class="col-span-2 mb-6 text-center text-sm font-light uppercase leading-4 tracking-0.75px text-subtle desktop:mb-0 desktop:pb-6 desktop:text-left desktop:leading-8 max:col-span-1 max:self-start"
    >
      {formatDate(review.date)}
    </div>
    <a
      rel="canonical"
      href={`/reviews/${review.slug}/`}
      class="still-border block max-w-prose desktop:col-start-4 desktop:col-end-9 desktop:row-span-2 desktop:row-start-1 desktop:mt-10 desktop:self-start desktop:justify-self-end max:row-start-1 max:mt-0"
    >
      <Still
        title={review.title}
        year={review.year}
        width={512}
        height={288}
        slug={review.slug}
        sizes="(min-width: 512px) 512px, 100vw"
        loading={eagerLoadImage ? "eager" : "lazy"}
        class="h-auto rounded-xl"
      />
    </a>
    <div
      class="flex max-w-lg flex-col items-center pt-4 desktop:col-span-5 desktop:col-start-1 desktop:row-start-2 desktop:items-start desktop:place-self-start desktop:pt-0 max:col-start-2 max:row-start-1"
    >
      <h2 class="text-2.5xl font-bold leading-8">
        <a
          href={`/reviews/${review.slug}/`}
          rel="canonical"
          class="inline-block text-default"
        >
          {review.title}{" "}
          <span
            class="inline-block text-base font-light leading-none text-subtle"
          >
            {review.year}
          </span>
        </a>
      </h2>
      <div class="spacer-y-4"></div>
      <Grade grade={review.grade} height={32} />
      <div class="spacer-y-6"></div>
      <p
        class="text-base font-normal leading-normal tracking-0.25px text-subtle"
      >
        Directed by {toSentence(review.directorNames)}. Starring{" "}
        {toSentence(review.principalCastNames)}.
      </p>
      <div class="spacer-y-6"></div>
      <RenderedMarkdown
        text={review.excerpt}
        className="self-start text-lg leading-normal tracking-0.3px text-muted"
      />
    </div>
  </article>
</li>
